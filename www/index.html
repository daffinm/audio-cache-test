<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Audio Cache Test</title>
    <meta id="meta-viewport" name="viewport" content="user-scalable=yes, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <!-- Avoid fake favicon requests to reduce console noise. -->
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <style>
        body {
            background-color: black;
            color: white;
            margin: 1rem 1rem 2rem 1rem;
        }
        .media-settings, .media-container {
            border: solid 1px greenyellow;
            border-radius: 10px;
            margin-bottom: 1rem;
        }
        .media-settings {
            padding: 0 1rem 0 1rem;
        }
        .media-settings h3 {
            display: inline-block;
        }
        .media {
            display: flex;
            justify-content: left;
            flex-flow: row wrap;
        }
        .media-container {
            padding: 0 1rem 1rem 1rem;
            height: fit-content;
            height: -moz-fit-content;
            width: fit-content;
            width: -moz-fit-content;
            margin-right: 1rem;
        }
        .highlight {
            border: solid 1px greenyellow;
            border-radius: 10px;
        }
/*
        @media only screen and (min-width : 700px) {
            .media-container {
                display: inline-block;
                vertical-align:top;
                margin-right: 0.5rem;
            }
        }
*/
        a:link {
            color: greenyellow;
        }
        a:visited {
            color: greenyellow;
        }
        a:hover {
            color: red;
        }
        a:active {
            color: yellow;
        }
        th {
            text-align: left;
        }
    </style>
    <script type="text/javascript">
        function applog(message, object) {
            console.log(`[ACT App] ${message}`, object ? object : '');
        }
    </script>
</head>
<body>
    <div class="media-settings">
        <h3>Media Settings:</h3>
        <label for="audio-format">Audio Format</label>
        <select id="audio-format">
            <option selected value=".mp3">MP3</option>
            <option value=".m4a">M4A</option>
        </select>
        <label for="crossorigin">Crossorigin</label>
        <select id="crossorigin">
            <option selected value="anonymous">anonymous</option>
            <option value="use-credentials">use-credentials</option>
            <option value="none">none</option>
        </select>
    </div>
    <div class="media">

        <div class="media-container">
            <h3>Audio: Preload=metadata</h3>
            <h4>Auto pre-cached (no range requests)</h4>
            <audio controls preload="metadata" crossorigin="anonymous" src="media/audio/auto-pre-cached-no-router.mp3"></audio>
            <h4>Auto pre-cached</h4>
            <audio controls preload="metadata" crossorigin="anonymous" src="media/audio/auto-pre-cached.mp3"></audio>
            <h4>Manually pre-cached</h4>
            <audio controls preload="metadata" crossorigin="anonymous" src="media/audio/manually-pre-cached.mp3"></audio>
            <h4>Not cached</h4>
            <audio controls preload="metadata" crossorigin="anonymous" src="media/audio/not-cached.mp3"></audio>
        </div>

        <div class="media-container">
            <h3>Audio: Preload=auto</h3>
            <h4>Auto pre-cached (no range requests)</h4>
            <audio controls preload="auto" crossorigin="anonymous" src="media/audio/auto-pre-cached-no-router.mp3"></audio>
            <h4>Auto pre-cached</h4>
            <audio controls preload="auto" crossorigin="anonymous" src="media/audio/auto-pre-cached.mp3"></audio>
            <h4>Manually pre-cached</h4>
            <audio controls preload="auto" crossorigin="anonymous" src="media/audio/manually-pre-cached.mp3"></audio>
            <h4>Not cached</h4>
            <audio controls preload="auto" crossorigin="anonymous" src="media/audio/not-cached.mp3"></audio>
        </div>

        <div class="media-container">
            <h3>Video: Preload=metadata</h3>
            <h4>Auto pre-cached (no range requests)</h4>
            <video controls preload="metadata" crossorigin="anonymous" src="media/video/auto-pre-cached-no-router.mp4"></video>
            <h4>Auto pre-cached</h4>
            <video controls preload="metadata" crossorigin="anonymous" src="media/video/auto-pre-cached.mp4"></video>
            <h4>Manually pre-cached</h4>
            <video controls preload="metadata" crossorigin="anonymous" src="media/video/manually-pre-cached.mp4"></video>
            <h4>Not cached</h4>
            <video controls preload="metadata" crossorigin="anonymous" src="media/video/not-cached.mp4"></video>
        </div>

        <div class="media-container">
            <h3>Video: Preload=auto</h3>
            <h4>Auto pre-cached (no range requests)</h4>
            <video controls preload="auto" crossorigin="anonymous" src="media/video/auto-pre-cached-no-router.mp4"></video>
            <h4>Auto pre-cached</h4>
            <video controls preload="auto" crossorigin="anonymous" src="media/video/auto-pre-cached.mp4"></video>
            <h4>Manually pre-cached</h4>
            <video controls preload="auto" crossorigin="anonymous" src="media/video/manually-pre-cached.mp4"></video>
            <h4>Not cached</h4>
            <video controls preload="auto" crossorigin="anonymous" src="media/video/not-cached.mp4"></video>
        </div>

    </div>

    <p>Media used in demo:
        Audio © 2003 Miaow / Arnaud Laflaquiere - <a href="http://www.miaowmusic.net" target="_blank">MiaowMusic.net</a><br>
        <!--Video © Blender Foundation | <a href="www.blender.org">www.blender.org</a>-->
    </p>

    <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript">
        function stopAllMedia() {
            $('audio,video').each(function () {
                this.pause(); // Stop playing
                this.currentTime = 0; // Reset time
            });
        }
        $(document).ready(function () {
            if ('serviceWorker' in navigator) {
                applog('This browser supports service workers.');
                navigator.serviceWorker
                    .register('sw.js')
                    .then(function () {
                        applog('ServiceWorker registered!');
                    })
                    .catch(function (err) {
                        applog('Cannot register service worker:', err);
                    });
            } else {
                applog('This browser DOES NOT support service workers.');
            }
            let $media = $('audio,video');
            $media.on('play', function () {
                $('audio,video').not(this).each(function(){
                    this.pause(); // Stop playing
                    this.currentTime = 0; // Reset time
                });
            });
            $media.on('error', function (e) {
                applog(`Error loading ${this.src}`, e);
            });
            if (!/Chrome/.test(navigator.userAgent)) {
                $media.addClass('highlight');
            }
            $('#audio-format').on('change', function () {
                stopAllMedia();
                let extension = this.value;
                $media.each(function () {
                    let $audio = $(this);
                    let src = $audio.attr('src').replace(/\.(mp3|m4a)$/, extension);
                    $audio.attr('src', src);
                })
            });
            $('#crossorigin').on('change', function () {
                stopAllMedia();
                let value = this.value;
                if (value === "none") {
                    $media.removeAttr('crossorigin');
                } else {
                    $media.attr('crossorigin', this.value);
                }
            });
        });
    </script>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <!--<script src="/__/firebase/7.0.0/firebase-app.js"></script>-->
    <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries -->
    <!-- Initialize Firebase -->
    <!--<script src="/__/firebase/init.js"></script>-->

</body>
</html>